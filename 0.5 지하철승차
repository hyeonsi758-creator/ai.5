Streamlit Subway App
Â· python
# streamlit_subway_app.py
# ì»¬ëŸ¬ ìƒì„±: 1ë“±ì€ ë¹¨ê°•, ë‚˜ë¨¸ì§€ëŠ” íŒŒë€ìƒ‰ì—ì„œ íë ¤ì§€ëŠ” ê·¸ë¼ë°ì´ì…˜
colors = []
for r in top10['rank']:
    if r == 1:
        colors.append('rgba(255,0,0,1)')  # ì™„ì „í•œ ë¹¨ê°•
    else:
        # íŒŒë€ ê³„ì—´(Plotly ê¸°ë³¸ íŒŒë‘: 31,119,180)ì—ì„œ íˆ¬ëª…ë„ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ë‚®ì¶¤
        # ìˆœìœ„ê°€ ë†’ì„ìˆ˜ë¡ ë¶ˆíˆ¬ëª…ë„ë¥¼ ë†’ì—¬ ì§„í•œ íŒŒë‘, ë‚®ì„ìˆ˜ë¡ ì˜…ì€ íŒŒë‘
        # ìš°ë¦¬ëŠ” rank 2..10 -> opacity 0.95 down to 0.25
        max_rank = top10['rank'].max()
        # linear interpolation
        opacity = 0.95 - ( (r - 2) / max(1, (max_rank - 2)) ) * (0.70)  # ë²”ìœ„ 0.95 ~ 0.25
        opacity = max(0.15, min(1.0, opacity))
        colors.append(f'rgba(31,119,180,{opacity:.2f})')


# Plotly ë§‰ëŒ€ ê·¸ë˜í”„
fig = go.Figure()
fig.add_trace(go.Bar(
    x=top10['ì—­ëª…'] + ' (' + top10['ë…¸ì„ ëª…'] + ')',
    y=top10['í•©ê³„'],
    text=top10['í•©ê³„'],
    textposition='auto',
    marker_color=colors,
    hovertemplate=(
        '<b>%{x}</b><br>' +
        'ìˆœìœ„: %{customdata[0]}<br>' +
        'ìŠ¹ì°¨: %{customdata[1]:,d}<br>' +
        'í•˜ì°¨: %{customdata[2]:,d}<br>' +
        'í•©ê³„: %{y:,d}<extra></extra>'
    ),
    customdata=top10[['rank','ìŠ¹ì°¨ì´ìŠ¹ê°ìˆ˜','í•˜ì°¨ì´ìŠ¹ê°ìˆ˜']].values
))


fig.update_layout(
    title=f"Top 10 ì—­ â€” {sel_date} / {sel_line}",
    xaxis_title="ì—­ (ë…¸ì„ )",
    yaxis_title="ìŠ¹ì°¨+í•˜ì°¨ í•©ê³„",
    template='plotly_white',
    uniformtext_minsize=8,
    uniformtext_mode='hide',
    margin=dict(l=40, r=20, t=80, b=120)
)


# ê·¸ë˜í”„ ì¶œë ¥
st.plotly_chart(fig, use_container_width=True)


# ë°ì´í„° í‘œ ë° CSV ë‹¤ìš´ë¡œë“œ
with st.expander("ğŸ” TOP10 ë°ì´í„° ë³´ê¸°/ë‹¤ìš´ë¡œë“œ"):
    st.dataframe(top10[['rank','ë…¸ì„ ëª…','ì—­ëª…','ìŠ¹ì°¨ì´ìŠ¹ê°ìˆ˜','í•˜ì°¨ì´ìŠ¹ê°ìˆ˜','í•©ê³„']])


    csv = top10.to_csv(index=False, encoding='utf-8-sig')
    st.download_button("CSVë¡œ ë‹¤ìš´ë¡œë“œ", data=csv, file_name=f"top10_{sel_date}_{sel_line}.csv", mime='text/csv')


st.markdown("---")
st.caption("ì•±: Plotly + Streamlit. ìƒ‰ìƒ: 1ë“± ë¹¨ê°•, ë‚˜ë¨¸ì§€ íŒŒë‘ ê³„ì—´ ê·¸ë¼ë°ì´ì…˜ ì²˜ë¦¬.")


# requirements.txt (ì°¸ê³ ):
# streamlit
# pandas
# plotly
